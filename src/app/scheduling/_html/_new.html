
<rbcf-menu></rbcf-menu>

<div class="content">
	<h1>
		Scheduler
		<img src="img/spinner.gif" class="spinner" alt="..." ng-show="responseStatus === -1" />
	</h1>
</div>

<div class="menu">
	<ul>
		<li><a href="#/scheduler">Scheduled Jobs</a></li>
		<li class="active"><a href="#/scheduler/new">New Scheduled Job</a></li>
	</ul>
</div>

<div class="content short-content">

	<!-- Error message -->
	<rbcf-error-message ng-show="responseStatus > 0 && responseStatus !== 404"></rbcf-error-message>

	<!-- Job properties -->
	<form novalidate name="newJobForm">

		<!-- Job name -->
		<div class="form-group" ng-class="{'has-error': newJobForm.jobname.$invalid && newJobForm.jobname.$dirty}">
			<label for="name" class="control-label">Job name</label>
			<span class="r-help" ng-show="newJobForm.name.$error.required">(required)</span><br />
			<input type="text" class="form-control" name="name" placeholder="a name" ng-model="job.name" required>
		</div>

		<!-- App name -->
		<div class="form-group" ng-class="{'has-error': newJobForm.appname.$invalid && newJobForm.appname.$dirty}">
			<label for="appname" class="control-label">Application name</label>
			<span class="r-help" ng-show="newJobForm.appname.$error.required">(required)</span><br />
			<select name="appname" class="form-control" required
					ng-model="job.app"
					ng-options="app.name for app in apps"
					ng-change="loadCommands()">
			</select>
		</div>

		<!-- Command name -->
		<div class="form-group" ng-class="{'has-error': newJobForm.cmdname.$invalid && newJobForm.cmdname.$dirty}">
			<label for="cmdname" class="control-label">Command name</label>
			<span class="r-help" ng-show="newJobForm.cmdname.$error.required">(required)</span><br />
			<select name="cmdname" class="form-control" required
					ng-model="job.cmdName"
					ng-options="cmd for cmd in cmdNames">
			</select>
		</div>

		<!-- CRON (edition) -->
		<div class="form-group">
			<label>
				Please, type in a <a href="https://fr.wikipedia.org/wiki/Cron">CRON expression</a> to setup the schedule.
				<span class="r-help" ng-show="newJobForm.cron.$error.required">(required)</span>
				<span class="r-help" ng-show="job.cron && cronIsInvalid()">(must contain either between 6 and 7 fields)</span>
				<br />
				You can use <a href="" ng-click="showCronEditor = true">our simplified CRON editor</a>.
			</label>

			<input type="text" class="form-control" name="cron" 
					placeholder="a CRON expression (e.g. to trigger a command every day: 0 0 * * *)" 
					ng-model="job.cron" required>
		</div>
		
		<div class="form-group">
			<label ng-show="showCronEditor"><a href="" ng-click="showCronEditor = false">Hide</a> our simplified CRON editor.</label>
			<!--
			<cron-selection output="job.cron" config="cronEditorConfig" ng-show="showCronEditor"></cron-selection>
			 -->
			 <quartz-cron-selection output="job.cron" config="cronEditorConfig" ng-show="showCronEditor"></quartz-cron-selection>
		</div>
	
		<p id="new-job-error" class="bg-danger" ng-show="errorMessage">{{ errorMessage }}</p>
		<button type="submit" class="btn btn-default pull-right" ng-disabled="! newJobForm.$valid" ng-click="createOrUpdateJob()">
			Submit
		</button>
	</form>

</div>
